<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vault â€” Personal Finance Tracker</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect x='4' y='34' width='52' height='24' rx='4' fill='%2322543d' transform='rotate(-8 32 46)'/%3E%3Crect x='7' y='36' width='46' height='20' rx='3' fill='%2327a063' transform='rotate(-8 32 46)'/%3E%3Cellipse cx='32' cy='46' rx='5' ry='5' fill='%231a7a4a' transform='rotate(-8 32 46)'/%3E%3Cellipse cx='32' cy='46' rx='3.5' ry='3.5' fill='%2332c87a' transform='rotate(-8 32 46)'/%3E%3Crect x='4' y='30' width='52' height='24' rx='4' fill='%231e4d38' transform='rotate(0 32 42)'/%3E%3Crect x='7' y='32' width='46' height='20' rx='3' fill='%2324a05a' transform='rotate(0 32 42)'/%3E%3Cellipse cx='32' cy='42' rx='5' ry='5' fill='%23177a42'/%3E%3Cellipse cx='32' cy='42' rx='3.5' ry='3.5' fill='%2330c070'/%3E%3Crect x='4' y='26' width='52' height='24' rx='4' fill='%23164030' transform='rotate(7 32 38)'/%3E%3Crect x='7' y='28' width='46' height='20' rx='3' fill='%231e9050' transform='rotate(7 32 38)'/%3E%3Cellipse cx='32' cy='38' rx='5' ry='5' fill='%23126635' transform='rotate(7 32 38)'/%3E%3Cellipse cx='32' cy='38' rx='3.5' ry='3.5' fill='%2328b862' transform='rotate(7 32 38)'/%3E%3Crect x='26' y='22' width='12' height='24' rx='2' fill='%23c9a84c' opacity='0.92'/%3E%3Crect x='27' y='23' width='10' height='22' rx='1.5' fill='%23f0d080' opacity='0.5'/%3E%3Ctext x='32' y='38' text-anchor='middle' font-family='Georgia,serif' font-size='11' font-weight='bold' fill='%23a07820' opacity='0.9'%3E%24%3C/text%3E%3C/svg%3E" />
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=DM+Mono:wght@300;400;500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet" />
<style>
:root {
  --bg:#080b0f; --surface:#0e1318; --card:#111820; --card2:#141d26;
  --border:rgba(255,255,255,0.07); --gold:#c9a84c; --gold-light:#f0d080;
  --gold-dim:rgba(201,168,76,0.15); --teal:#4ccfb0; --rose:#e05c7a;
  --text:#e8e8e0; --muted:#6b7a8d; --accent:#1e2d3d;
  --sidebar-w: 220px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;font-weight:300;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:0.4;}
body::after{content:'';position:fixed;top:-200px;right:-200px;width:600px;height:600px;background:radial-gradient(circle,rgba(201,168,76,0.06) 0%,transparent 70%);pointer-events:none;z-index:0;}

/* â”€â”€ ONBOARDING â”€â”€ */
#onboarding{position:fixed;inset:0;background:var(--bg);z-index:500;display:flex;align-items:center;justify-content:center;padding:1rem;}
.ob-box{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:2.5rem;width:440px;max-width:100%;text-align:center;animation:fadeUp .6s ease both;}
.ob-logo{font-family:'Cormorant Garamond',serif;font-size:3rem;font-weight:300;color:var(--gold);letter-spacing:.1em;}
.ob-tagline{font-family:'DM Mono',monospace;font-size:.6rem;color:var(--muted);letter-spacing:.25em;text-transform:uppercase;margin-bottom:2rem;}
.ob-title{font-size:1rem;font-weight:500;margin-bottom:1.5rem;color:var(--text);}
.ob-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:.75rem 1rem;color:var(--text);font-family:'Outfit',sans-serif;font-size:.9rem;outline:none;transition:border-color .2s;margin-bottom:.75rem;}
.ob-input:focus{border-color:var(--gold);}
.ob-row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-bottom:.75rem;}
.ob-label{display:block;font-family:'DM Mono',monospace;font-size:.58rem;color:var(--muted);letter-spacing:.18em;text-transform:uppercase;margin-bottom:.35rem;text-align:left;}
.ob-hint{font-size:.72rem;color:var(--muted);margin-bottom:1.5rem;}
.ob-btn{width:100%;padding:.85rem;background:var(--gold);color:#0a0a0a;font-family:'Outfit',sans-serif;font-size:.9rem;font-weight:600;border:none;border-radius:8px;cursor:pointer;transition:background .2s;}
.ob-btn:hover{background:var(--gold-light);}

/* â”€â”€ LAYOUT â”€â”€ */
.shell{display:flex;min-height:100vh;position:relative;z-index:1;}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar{background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;padding:2rem 0;position:fixed;top:0;left:0;width:var(--sidebar-w);height:100vh;overflow-y:auto;z-index:200;transition:transform .3s ease;}
.logo{padding:0 1.5rem 1.75rem;border-bottom:1px solid var(--border);}
.logo-mark{font-family:'Cormorant Garamond',serif;font-size:1.9rem;font-weight:300;color:var(--gold);letter-spacing:.08em;line-height:1;}
.logo-sub{font-family:'DM Mono',monospace;font-size:.55rem;color:var(--muted);letter-spacing:.22em;text-transform:uppercase;margin-top:.2rem;}
.nav{padding:1.25rem 0;flex:1;}
.nav-label{font-family:'DM Mono',monospace;font-size:.52rem;color:var(--muted);letter-spacing:.3em;text-transform:uppercase;padding:0 1.5rem;margin-bottom:.5rem;}
.nav-item{display:flex;align-items:center;gap:.75rem;padding:.6rem 1.5rem;cursor:pointer;transition:all .2s;color:var(--muted);font-size:.82rem;font-weight:400;border-left:2px solid transparent;}
.nav-item:hover{color:var(--text);background:rgba(255,255,255,.02);}
.nav-item.active{color:var(--gold);border-left-color:var(--gold);background:var(--gold-dim);}
.nav-section{margin-bottom:1.25rem;}
.nav-icon{width:15px;height:15px;opacity:.7;flex-shrink:0;}
.nav-item.active .nav-icon{opacity:1;}
.sidebar-footer{padding:1.1rem 1.5rem;border-top:1px solid var(--border);}
.user-chip{display:flex;align-items:center;gap:.65rem;}
.avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#8a5c10);display:flex;align-items:center;justify-content:center;font-family:'Cormorant Garamond',serif;font-size:.85rem;color:#fff;flex-shrink:0;cursor:pointer;}
.user-info{overflow:hidden;flex:1;min-width:0;}
.user-name{font-size:.8rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.user-plan{font-family:'DM Mono',monospace;font-size:.52rem;color:var(--gold);letter-spacing:.12em;text-transform:uppercase;}
.reset-btn{font-size:.58rem;color:var(--muted);cursor:pointer;text-decoration:underline;background:none;border:none;font-family:'Outfit',sans-serif;padding:0;margin-top:.15rem;display:block;}
.reset-btn:hover{color:var(--rose);}

/* â”€â”€ MOBILE TOP BAR â”€â”€ */
.topbar{display:none;align-items:center;justify-content:space-between;padding:.85rem 1rem;background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:150;}
.topbar-logo{font-family:'Cormorant Garamond',serif;font-size:1.5rem;color:var(--gold);}
.hamburger{background:none;border:none;cursor:pointer;color:var(--muted);padding:.25rem;display:flex;flex-direction:column;gap:4px;}
.hamburger span{display:block;width:20px;height:2px;background:currentColor;border-radius:2px;transition:all .3s;}
.hamburger.open span:nth-child(1){transform:rotate(45deg) translate(4px,4px);}
.hamburger.open span:nth-child(2){opacity:0;}
.hamburger.open span:nth-child(3){transform:rotate(-45deg) translate(4px,-4px);}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:190;}

/* â”€â”€ VIEWS â”€â”€ */
.view{display:none;}
.view.active{display:block;}

/* â”€â”€ MAIN â”€â”€ */
.main-wrap{margin-left:var(--sidebar-w);flex:1;min-width:0;}
.main{padding:2rem 2rem 4rem;max-width:1060px;width:100%;}
.page-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2rem;animation:fadeUp .6s ease both;gap:1rem;flex-wrap:wrap;}
.page-title{font-family:'Cormorant Garamond',serif;font-size:2.2rem;font-weight:300;line-height:1.1;}
.page-title span{color:var(--gold);}
.page-date{font-family:'DM Mono',monospace;font-size:.6rem;color:var(--muted);letter-spacing:.15em;margin-top:.2rem;}
.header-actions{display:flex;gap:.6rem;align-items:center;flex-shrink:0;}
.btn{padding:.55rem 1.1rem;border-radius:6px;font-family:'Outfit',sans-serif;font-size:.76rem;font-weight:500;cursor:pointer;transition:all .2s;letter-spacing:.03em;border:none;}
.btn-ghost{background:transparent;color:var(--muted);border:1px solid var(--border);}
.btn-ghost:hover{border-color:var(--gold);color:var(--gold);}
.btn-primary{background:var(--gold);color:#0a0a0a;font-weight:600;}
.btn-primary:hover{background:var(--gold-light);}
.btn-danger{background:transparent;color:var(--rose);border:1px solid rgba(224,92,122,.3);font-size:.68rem;padding:.35rem .65rem;}
.btn-danger:hover{background:rgba(224,92,122,.1);}

/* â”€â”€ STAT CARDS â”€â”€ */
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.85rem;margin-bottom:1.5rem;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.2rem 1.25rem;position:relative;overflow:hidden;transition:border-color .3s,transform .2s;animation:fadeUp .6s ease both;}
.stat-card:nth-child(1){animation-delay:.05s;} .stat-card:nth-child(2){animation-delay:.1s;} .stat-card:nth-child(3){animation-delay:.15s;} .stat-card:nth-child(4){animation-delay:.2s;}
.stat-card:hover{border-color:rgba(201,168,76,.3);transform:translateY(-2px);}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent-color,var(--gold));opacity:.6;}
.stat-card.teal{--accent-color:var(--teal);} .stat-card.rose{--accent-color:var(--rose);} .stat-card.neutral{--accent-color:var(--muted);}
.stat-label{font-family:'DM Mono',monospace;font-size:.55rem;color:var(--muted);letter-spacing:.2em;text-transform:uppercase;margin-bottom:.45rem;}
.stat-value{font-family:'Cormorant Garamond',serif;font-size:1.75rem;font-weight:300;line-height:1;}
.stat-value .currency{font-size:.9rem;color:var(--muted);vertical-align:super;margin-right:2px;}
.stat-change{display:flex;align-items:center;gap:.3rem;margin-top:.45rem;font-size:.67rem;color:var(--muted);}
.stat-change.up{color:var(--teal);} .stat-change.down{color:var(--rose);}

/* â”€â”€ MAIN GRID â”€â”€ */
.main-grid{display:grid;grid-template-columns:1fr 280px;gap:1rem;margin-bottom:1rem;align-items:start;}
.chart-card,.breakdown-card,.tx-card,.goals-card,.all-tx-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.35rem;animation:fadeUp .6s ease both;}
.chart-card{animation-delay:.25s;min-width:0;} .breakdown-card{animation-delay:.3s;}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:.5rem;}
.card-title{font-family:'Cormorant Garamond',serif;font-size:1.1rem;font-weight:400;}
.card-meta{font-family:'DM Mono',monospace;font-size:.57rem;color:var(--muted);letter-spacing:.1em;}
.period-tabs{display:flex;gap:.2rem;background:var(--surface);padding:.2rem;border-radius:6px;flex-shrink:0;}
.period-tab{padding:.28rem .65rem;border-radius:4px;font-size:.67rem;font-weight:500;cursor:pointer;color:var(--muted);transition:all .15s;border:none;background:transparent;font-family:'Outfit',sans-serif;}
.period-tab.active{background:var(--card2);color:var(--gold);}

/* Chart container â€” fixed height, no overflow */
.chart-wrap{position:relative;height:180px;width:100%;}
.chart-wrap canvas{position:absolute;top:0;left:0;width:100%!important;height:100%!important;}

/* â”€â”€ DONUT â”€â”€ */
.donut-wrap{position:relative;margin:.6rem auto;width:130px;height:130px;}
.donut-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.donut-amount{font-family:'Cormorant Garamond',serif;font-size:1.25rem;font-weight:300;line-height:1;}
.donut-label{font-family:'DM Mono',monospace;font-size:.47rem;color:var(--muted);letter-spacing:.12em;margin-top:.2rem;}
.legend{margin-top:.65rem;display:flex;flex-direction:column;gap:.42rem;}
.legend-item{display:flex;align-items:center;justify-content:space-between;font-size:.74rem;}
.legend-left{display:flex;align-items:center;gap:.5rem;}
.legend-dot{width:7px;height:7px;border-radius:2px;flex-shrink:0;}
.legend-val{font-family:'DM Mono',monospace;font-size:.67rem;color:var(--muted);}

/* â”€â”€ BOTTOM â”€â”€ */
.bottom-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}

/* â”€â”€ TRANSACTIONS â”€â”€ */
.tx-list{display:flex;flex-direction:column;gap:0;margin-top:.2rem;}
.tx-item{display:flex;align-items:center;gap:.8rem;padding:.65rem .4rem;border-bottom:1px solid var(--border);cursor:default;transition:background .15s;border-radius:6px;}
.tx-item:hover{background:rgba(255,255,255,.025);}
.tx-item:last-child{border-bottom:none;}
.tx-icon{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.95rem;flex-shrink:0;}
.tx-info{flex:1;min-width:0;}
.tx-name{font-size:.79rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.tx-meta{font-family:'DM Mono',monospace;font-size:.55rem;color:var(--muted);letter-spacing:.06em;margin-top:.1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.tx-right{display:flex;flex-direction:column;align-items:flex-end;gap:.25rem;flex-shrink:0;}
.tx-amount{font-family:'DM Mono',monospace;font-size:.79rem;font-weight:500;}
.tx-amount.credit{color:var(--teal);} .tx-amount.debit{color:var(--text);}
.tx-del{background:none;border:none;color:var(--muted);cursor:pointer;font-size:.75rem;line-height:1;padding:.1rem .3rem;border-radius:3px;opacity:0;transition:opacity .15s,color .15s;}
.tx-item:hover .tx-del{opacity:1;}
.tx-del:hover{color:var(--rose);}

/* â”€â”€ GOALS â”€â”€ */
.goal-item{margin-bottom:1rem;position:relative;}
.goal-item:last-child{margin-bottom:0;}
.goal-header{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:.4rem;gap:.5rem;}
.goal-name{font-size:.8rem;font-weight:500;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.goal-pct{font-family:'DM Mono',monospace;font-size:.58rem;color:var(--muted);flex-shrink:0;}
.progress-track{height:3px;background:var(--accent);border-radius:99px;overflow:hidden;}
.progress-fill{height:100%;border-radius:99px;transition:width 1.5s cubic-bezier(.16,1,.3,1);}
.goal-sub{display:flex;justify-content:space-between;margin-top:.3rem;font-family:'DM Mono',monospace;font-size:.55rem;color:var(--muted);gap:.5rem;}
.goal-sub span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.goal-actions{display:flex;gap:.35rem;margin-top:.4rem;}
.goal-mini-btn{font-size:.6rem;padding:.22rem .55rem;border-radius:4px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--muted);font-family:'Outfit',sans-serif;transition:all .15s;}
.goal-mini-btn:hover{border-color:var(--gold);color:var(--gold);}
.goal-mini-btn.del:hover{border-color:var(--rose);color:var(--rose);}

/* â”€â”€ ALL TRANSACTIONS VIEW â”€â”€ */
.all-tx-card{animation-delay:.2s;}
.filter-bar{display:flex;gap:.45rem;flex-wrap:wrap;margin-bottom:.9rem;}
.filter-select{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:.38rem .7rem;color:var(--text);font-family:'Outfit',sans-serif;font-size:.73rem;outline:none;cursor:pointer;}
.filter-select:focus{border-color:var(--gold);}
.search-input{flex:1;min-width:130px;background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:.38rem .7rem;color:var(--text);font-family:'Outfit',sans-serif;font-size:.73rem;outline:none;}
.search-input:focus{border-color:var(--gold);}
.tx-table{width:100%;border-collapse:collapse;font-size:.78rem;}
.tx-table th{font-family:'DM Mono',monospace;font-size:.52rem;color:var(--muted);letter-spacing:.15em;text-transform:uppercase;text-align:left;padding:.48rem .55rem;border-bottom:1px solid var(--border);}
.tx-table td{padding:.6rem .55rem;border-bottom:1px solid rgba(255,255,255,.04);vertical-align:middle;}
.tx-table tr:last-child td{border-bottom:none;}
.tx-table tr:hover td{background:rgba(255,255,255,.02);}
.badge{display:inline-block;padding:.14rem .5rem;border-radius:4px;font-size:.6rem;font-weight:500;}

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty{text-align:center;padding:2.5rem 1rem;}
.empty-icon{font-size:2.2rem;margin-bottom:.65rem;opacity:.4;}
.empty-title{font-family:'Cormorant Garamond',serif;font-size:1.2rem;color:var(--muted);margin-bottom:.35rem;}
.empty-sub{font-size:.75rem;color:var(--muted);opacity:.7;}

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(6px);z-index:300;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;padding:1rem;}
.modal-overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--card2);border:1px solid var(--border);border-radius:16px;padding:1.75rem;width:440px;max-width:100%;transform:translateY(24px);transition:transform .3s cubic-bezier(.16,1,.3,1);max-height:90vh;overflow-y:auto;}
.modal-overlay.open .modal{transform:translateY(0);}
.modal-title{font-family:'Cormorant Garamond',serif;font-size:1.45rem;font-weight:300;margin-bottom:1.35rem;}
.form-group{margin-bottom:.9rem;}
.form-label{display:block;font-family:'DM Mono',monospace;font-size:.56rem;color:var(--muted);letter-spacing:.18em;text-transform:uppercase;margin-bottom:.35rem;}
.form-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:.6rem .85rem;color:var(--text);font-family:'Outfit',sans-serif;font-size:.84rem;outline:none;transition:border-color .2s;}
.form-input:focus{border-color:var(--gold);}
select.form-input option{background:var(--card2);}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:.7rem;}
.modal-actions{display:flex;gap:.65rem;margin-top:1.35rem;justify-content:flex-end;}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--card2);border:1px solid var(--gold);border-radius:10px;padding:.8rem 1.1rem;font-size:.78rem;color:var(--gold);z-index:999;transform:translateY(80px);opacity:0;transition:all .4s cubic-bezier(.16,1,.3,1);display:flex;align-items:center;gap:.55rem;max-width:calc(100vw - 3rem);}
.toast.show{transform:translateY(0);opacity:1;}
.toast.error{border-color:var(--rose);color:var(--rose);}

/* â”€â”€ CHART LEGEND â”€â”€ */
.chart-legend{display:flex;gap:1.1rem;margin-top:.6rem;}
.chart-legend-item{display:flex;align-items:center;gap:.35rem;font-size:.7rem;color:var(--muted);}
.chart-legend-line{display:inline-block;width:14px;height:2.5px;border-radius:2px;}

@keyframes fadeUp{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
::-webkit-scrollbar{width:4px;} ::-webkit-scrollbar-track{background:transparent;} ::-webkit-scrollbar-thumb{background:var(--border);border-radius:99px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE BREAKPOINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Large tablets â€” sidebar gets narrow, 2-col stats */
@media(max-width:1024px){
  :root{ --sidebar-w: 200px; }
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  .main-grid{grid-template-columns:1fr 250px;}
}

/* Tablets â€” collapse sidebar to overlay */
@media(max-width:768px){
  .topbar{display:flex;}
  .sidebar{transform:translateX(-100%);}
  .sidebar.open{transform:translateX(0);}
  .sidebar-overlay.open{display:block;}
  .main-wrap{margin-left:0;}
  .main{padding:1.25rem 1rem 3rem;}
  .stats-grid{grid-template-columns:repeat(2,1fr);gap:.7rem;}
  .main-grid{grid-template-columns:1fr;gap:.85rem;}
  .breakdown-card .donut-wrap{width:120px;height:120px;}
  .bottom-grid{grid-template-columns:1fr;gap:.85rem;}
  .page-title{font-size:1.75rem;}
  .filter-bar{gap:.35rem;}
  .filter-select,.search-input{font-size:.7rem;}
}

/* Phones */
@media(max-width:480px){
  .stats-grid{grid-template-columns:1fr 1fr;}
  .stat-value{font-size:1.5rem;}
  .ob-row{grid-template-columns:1fr;}
  .form-row{grid-template-columns:1fr;}
  .header-actions .btn-ghost{display:none;}
  .modal{padding:1.35rem;}
  .page-header{gap:.65rem;}
  .page-title{font-size:1.5rem;}
}
</style>
</head>
<body>

<!-- â•â• ONBOARDING â•â• -->
<div id="onboarding">
  <div class="ob-box">
    <div class="ob-logo">Vault</div>
    <div class="ob-tagline">Personal Finance OS</div>
    <div class="ob-title">Let's set up your profile</div>
    <label class="ob-label">Your Name</label>
    <input class="ob-input" id="ob-name" type="text" placeholder="e.g. Immaculate" autocomplete="name" />
    <div class="ob-row">
      <div>
        <label class="ob-label">Currency Symbol</label>
        <select class="ob-input" id="ob-currency">
          <option value="UGX">UGX</option>
          <option value="$">$ USD</option>
          <option value="KSh">KSh</option>
          <option value="â‚¬">â‚¬ EUR</option>
          <option value="Â£">Â£ GBP</option>
          <option value="â‚¦">â‚¦ NGN</option>
          <option value="R">R ZAR</option>
          <option value="GHâ‚µ">GHâ‚µ GHS</option>
          <option value="TSh">TSh TZS</option>
        </select>
      </div>
      <div>
        <label class="ob-label">Opening Balance</label>
        <input class="ob-input" id="ob-balance" type="number" placeholder="0.00" min="0" step="0.01" />
      </div>
    </div>
    <div class="ob-hint">Your opening balance is your current money on hand before tracking begins.</div>
    <button class="ob-btn" onclick="completeOnboarding()">Start Tracking â†’</button>
  </div>
</div>

<!-- â•â• APP SHELL â•â• -->
<div class="shell" id="appShell" style="display:none;">

  <!-- Mobile overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

  <aside class="sidebar" id="sidebar">
    <div class="logo">
      <div class="logo-mark">Vault</div>
      <div class="logo-sub">Finance OS</div>
    </div>
    <nav class="nav">
      <div class="nav-section">
        <div class="nav-label">Overview</div>
        <div class="nav-item active" onclick="showView('dashboard',this)">
          <svg class="nav-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Dashboard
        </div>
      </div>
      <div class="nav-section">
        <div class="nav-label">Money</div>
        <div class="nav-item" onclick="showView('transactions',this)">
          <svg class="nav-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" stroke-linecap="round" stroke-linejoin="round"/></svg>
          All Transactions
        </div>
        <div class="nav-item" onclick="showView('goals',this)">
          <svg class="nav-icon" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Savings Goals
        </div>
      </div>
    </nav>
    <div class="sidebar-footer">
      <div class="user-chip">
        <div class="avatar" id="sidebarAvatar">?</div>
        <div class="user-info">
          <div class="user-name" id="sidebarName">â€”</div>
          <div class="user-plan">Vault Member</div>
          <button class="reset-btn" onclick="confirmReset()">Reset all data</button>
        </div>
      </div>
    </div>
  </aside>

  <div class="main-wrap">
    <!-- Mobile top bar -->
    <div class="topbar">
      <div class="topbar-logo">Vault</div>
      <button class="hamburger" id="hamburger" onclick="toggleSidebar()">
        <span></span><span></span><span></span>
      </button>
    </div>

    <main class="main">

      <!-- â•â• DASHBOARD VIEW â•â• -->
      <div class="view active" id="view-dashboard">
        <div class="page-header">
          <div>
            <div class="page-title">Good <span id="timeGreet">day</span>, <span id="headerName">â€”</span></div>
            <div class="page-date" id="currentDate"></div>
          </div>
          <div class="header-actions">
            <button class="btn btn-ghost" onclick="exportData()">â†“ Export</button>
            <button class="btn btn-primary" onclick="openModal()">+ Add Transaction</button>
          </div>
        </div>

        <!-- STATS -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Current Balance</div>
            <div class="stat-value"><span class="currency" id="s-cur1"></span><span id="s-balance">0</span></div>
            <div class="stat-change" id="s-balance-sub">Your running total</div>
          </div>
          <div class="stat-card teal">
            <div class="stat-label">Total Income</div>
            <div class="stat-value"><span class="currency" id="s-cur2"></span><span id="s-income">0</span></div>
            <div class="stat-change up" id="s-income-sub">â†‘ All time</div>
          </div>
          <div class="stat-card rose">
            <div class="stat-label">Total Expenses</div>
            <div class="stat-value"><span class="currency" id="s-cur3"></span><span id="s-spend">0</span></div>
            <div class="stat-change down" id="s-spend-sub">â†“ All time</div>
          </div>
          <div class="stat-card neutral">
            <div class="stat-label">Savings Rate</div>
            <div class="stat-value"><span id="s-rate">0</span><span class="currency">%</span></div>
            <div class="stat-change" id="s-rate-sub">Income vs expenses</div>
          </div>
        </div>

        <!-- CHART + DONUT -->
        <div class="main-grid">
          <div class="chart-card">
            <div class="card-header">
              <div>
                <div class="card-title">Cash Flow</div>
                <div class="card-meta">Monthly income &amp; expenses</div>
              </div>
              <div class="period-tabs">
                <button class="period-tab active" onclick="setPeriod(this,'3m')">3M</button>
                <button class="period-tab" onclick="setPeriod(this,'6m')">6M</button>
                <button class="period-tab" onclick="setPeriod(this,'all')">ALL</button>
              </div>
            </div>
            <div class="chart-wrap">
              <canvas id="spendChart"></canvas>
            </div>
            <div class="chart-legend">
              <div class="chart-legend-item"><span class="chart-legend-line" style="background:var(--teal)"></span>Income</div>
              <div class="chart-legend-item"><span class="chart-legend-line" style="background:var(--rose)"></span>Expenses</div>
            </div>
          </div>
          <div class="breakdown-card">
            <div class="card-header">
              <div class="card-title">Spending</div>
              <div class="card-meta">By category</div>
            </div>
            <div class="donut-wrap">
              <canvas id="donutChart" width="130" height="130"></canvas>
              <div class="donut-center">
                <div class="donut-amount" id="donut-total">â€”</div>
                <div class="donut-label">EXPENSES</div>
              </div>
            </div>
            <div class="legend" id="legendList"></div>
          </div>
        </div>

        <!-- RECENT TX + GOALS -->
        <div class="bottom-grid">
          <div class="tx-card">
            <div class="card-header">
              <div class="card-title">Recent Transactions</div>
              <div class="card-meta" id="txCount">0 entries</div>
            </div>
            <div class="tx-list" id="txList"></div>
          </div>
          <div class="goals-card">
            <div class="card-header">
              <div class="card-title">Savings Goals</div>
              <button class="btn btn-ghost" style="padding:.3rem .65rem;" onclick="openGoalModal()">+ Goal</button>
            </div>
            <div id="goalsList-dash"></div>
          </div>
        </div>
      </div>

      <!-- â•â• ALL TRANSACTIONS VIEW â•â• -->
      <div class="view" id="view-transactions">
        <div class="page-header">
          <div>
            <div class="page-title">All <span>Transactions</span></div>
            <div class="page-date" id="txViewCount">Complete history</div>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openModal()">+ Add Transaction</button>
          </div>
        </div>
        <div class="all-tx-card">
          <div class="filter-bar">
            <input class="search-input" id="txSearch" type="text" placeholder="ğŸ” Searchâ€¦" oninput="renderAllTx()" />
            <select class="filter-select" id="txFilterType" onchange="renderAllTx()">
              <option value="">All Types</option>
              <option value="credit">Income</option>
              <option value="debit">Expense</option>
            </select>
            <select class="filter-select" id="txFilterCat" onchange="renderAllTx()">
              <option value="">All Categories</option>
            </select>
            <select class="filter-select" id="txFilterMonth" onchange="renderAllTx()">
              <option value="">All Months</option>
            </select>
          </div>
          <div style="overflow-x:auto;">
            <table class="tx-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Category</th>
                  <th>Type</th>
                  <th style="text-align:right;">Amount</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="allTxBody"></tbody>
            </table>
          </div>
          <div id="allTxEmpty" class="empty" style="display:none;">
            <div class="empty-icon">ğŸ“‹</div>
            <div class="empty-title">No transactions found</div>
            <div class="empty-sub">Try adjusting your filters or add a new transaction.</div>
          </div>
        </div>
      </div>

      <!-- â•â• GOALS VIEW â•â• -->
      <div class="view" id="view-goals">
        <div class="page-header">
          <div>
            <div class="page-title">Savings <span>Goals</span></div>
            <div class="page-date">Track your financial targets</div>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openGoalModal()">+ New Goal</button>
          </div>
        </div>
        <div id="goalsList-full" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:1rem;"></div>
        <div id="goalsEmpty" class="empty" style="display:none;">
          <div class="empty-icon">ğŸ¯</div>
          <div class="empty-title">No goals yet</div>
          <div class="empty-sub">Set a savings goal and track your progress toward it.</div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- â•â• ADD TRANSACTION MODAL â•â• -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModalCheck(event)">
  <div class="modal">
    <div class="modal-title">Add Transaction</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Type</label>
        <select class="form-input" id="txType">
          <option value="debit">Expense</option>
          <option value="credit">Income</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Amount</label>
        <input class="form-input" id="txAmount" type="number" placeholder="0.00" min="0.01" step="0.01" />
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Description</label>
      <input class="form-input" id="txDesc" type="text" placeholder="e.g. Rent payment, Salary, Groceriesâ€¦" />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Category</label>
        <select class="form-input" id="txCat">
          <option>Housing</option><option>Food</option><option>Transport</option>
          <option>Health</option><option>Entertainment</option><option>Shopping</option>
          <option>Utilities</option><option>Education</option><option>Salary</option>
          <option>Business</option><option>Investment</option><option>Other</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Date</label>
        <input class="form-input" id="txDate" type="date" />
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Note (optional)</label>
      <input class="form-input" id="txNote" type="text" placeholder="Any extra detailâ€¦" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="addTransaction()">Save Transaction</button>
    </div>
  </div>
</div>

<!-- â•â• GOAL MODAL â•â• -->
<div class="modal-overlay" id="goalModalOverlay" onclick="closeGoalCheck(event)">
  <div class="modal">
    <div class="modal-title">New Savings Goal</div>
    <div class="form-group">
      <label class="form-label">Goal Name</label>
      <input class="form-input" id="goalName" type="text" placeholder="e.g. Emergency Fund, New Laptopâ€¦" />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Target Amount</label>
        <input class="form-input" id="goalTarget" type="number" placeholder="10000" min="1" step="0.01" />
      </div>
      <div class="form-group">
        <label class="form-label">Already Saved</label>
        <input class="form-input" id="goalSaved" type="number" placeholder="0" min="0" step="0.01" />
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Target Date (optional)</label>
      <input class="form-input" id="goalDate" type="date" />
    </div>
    <div class="form-group">
      <label class="form-label">Color</label>
      <select class="form-input" id="goalColor">
        <option value="#c9a84c">Gold</option><option value="#4ccfb0">Teal</option>
        <option value="#e05c7a">Rose</option><option value="#6b9de8">Blue</option>
        <option value="#a78bfa">Violet</option><option value="#fb923c">Orange</option>
      </select>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeGoalModal()">Cancel</button>
      <button class="btn btn-primary" onclick="addGoal()">Add Goal</button>
    </div>
  </div>
</div>

<!-- â•â• DEPOSIT TO GOAL MODAL â•â• -->
<div class="modal-overlay" id="depositModal" onclick="closeDepositCheck(event)">
  <div class="modal" style="width:340px;">
    <div class="modal-title">Add to Goal</div>
    <div class="form-group">
      <label class="form-label">Goal</label>
      <div class="form-input" id="depositGoalName" style="pointer-events:none;opacity:.7;"></div>
    </div>
    <div class="form-group">
      <label class="form-label">Amount to Add</label>
      <input class="form-input" id="depositAmount" type="number" placeholder="0.00" min="0.01" step="0.01" />
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeDepositModal()">Cancel</button>
      <button class="btn btn-primary" onclick="depositToGoal()">Add â†’</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let profile    = JSON.parse(localStorage.getItem('vault_profile') || 'null');
let txList     = JSON.parse(localStorage.getItem('vault_tx')      || '[]');
let goals      = JSON.parse(localStorage.getItem('vault_goals')   || '[]');
let currentPeriod = '3m';
let depositGoalIdx = -1;

const catEmoji = {
  Housing:'ğŸ ', Food:'ğŸ”', Transport:'ğŸš—', Health:'ğŸ’Š',
  Entertainment:'ğŸ®', Shopping:'ğŸ›ï¸', Utilities:'ğŸ’¡', Education:'ğŸ“š',
  Salary:'ğŸ’°', Business:'ğŸ’¼', Investment:'ğŸ“ˆ', Other:'ğŸ“¦'
};
const catColors = {
  Housing:'#c9a84c', Food:'#4ccfb0', Transport:'#6b9de8', Health:'#e05c7a',
  Entertainment:'#a78bfa', Shopping:'#fb923c', Utilities:'#38bdf8', Education:'#34d399',
  Salary:'#fbbf24', Business:'#94a3b8', Investment:'#4ade80', Other:'#6b7a8d'
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOBILE SIDEBAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSidebar() {
  const s = document.getElementById('sidebar');
  const o = document.getElementById('sidebarOverlay');
  const h = document.getElementById('hamburger');
  const isOpen = s.classList.toggle('open');
  o.classList.toggle('open', isOpen);
  h.classList.toggle('open', isOpen);
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
  document.getElementById('hamburger').classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ONBOARDING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function completeOnboarding() {
  const name    = document.getElementById('ob-name').value.trim();
  const symbol  = document.getElementById('ob-currency').value;
  const balance = parseFloat(document.getElementById('ob-balance').value) || 0;
  if (!name) { showToast('Please enter your name', true); return; }
  profile = { name, symbol, openingBalance: balance };
  localStorage.setItem('vault_profile', JSON.stringify(profile));
  startApp();
}

function startApp() {
  document.getElementById('onboarding').style.display = 'none';
  document.getElementById('appShell').style.display   = '';
  const h = new Date().getHours();
  document.getElementById('timeGreet').textContent = h < 12 ? 'morning' : h < 18 ? 'afternoon' : 'evening';
  document.getElementById('headerName').textContent = profile.name.split(' ')[0];
  document.getElementById('sidebarName').textContent = profile.name;
  document.getElementById('sidebarAvatar').textContent = profile.name[0].toUpperCase();
  document.querySelectorAll('.currency').forEach(el => el.textContent = profile.symbol);
  document.getElementById('currentDate').textContent =
    new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});
  document.getElementById('txDate').valueAsDate = new Date();
  refreshAll();
}

function confirmReset() {
  if (confirm('âš ï¸ This will delete ALL your data. Are you sure?')) {
    localStorage.clear(); location.reload();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function save() {
  localStorage.setItem('vault_tx',    JSON.stringify(txList));
  localStorage.setItem('vault_goals', JSON.stringify(goals));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcStats() {
  const income   = txList.filter(t=>t.type==='credit').reduce((s,t)=>s+t.amount,0);
  const expenses = txList.filter(t=>t.type==='debit').reduce((s,t)=>s+t.amount,0);
  const balance  = (profile.openingBalance || 0) + income - expenses;
  const rate     = income > 0 ? ((income - expenses) / income * 100) : 0;
  return { income, expenses, balance, rate };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REFRESH ALL UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function refreshAll() {
  const { income, expenses, balance, rate } = calcStats();
  animateCount('s-balance', balance);
  animateCount('s-income',  income);
  animateCount('s-spend',   expenses);
  document.getElementById('s-rate').textContent = rate.toFixed(1);
  const rateEl = document.getElementById('s-rate-sub');
  if (income === 0) { rateEl.textContent = 'No income recorded yet'; rateEl.className = 'stat-change'; }
  else if (rate >= 0) { rateEl.textContent = rate >= 20 ? 'âœ¦ Great savings rate!' : 'Try to save 20%+'; rateEl.className = 'stat-change '+(rate>=20?'up':''); }
  else { rateEl.textContent = 'âš  Spending exceeds income'; rateEl.className = 'stat-change down'; }
  document.getElementById('s-balance-sub').textContent =
    `Opening ${profile.symbol}${fmt(profile.openingBalance||0)} + net flow`;
  renderRecentTx();
  renderGoalsDash();
  renderGoalsFull();
  drawDonut();
  drawLineChart(currentPeriod);
  renderAllTx();
  updateFilterOptions();
}

function fmt(n) { return Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); }

function animateCount(id, end) {
  const el = document.getElementById(id);
  let s;
  const step = (ts) => {
    if (!s) s = ts;
    const p = Math.min((ts-s)/900,1);
    const e = 1 - Math.pow(1-p,3);
    el.textContent = fmt(e * end);
    if (p < 1) requestAnimationFrame(step);
  };
  requestAnimationFrame(step);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RECENT TRANSACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRecentTx() {
  const list   = document.getElementById('txList');
  const recent = [...txList].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,8);
  document.getElementById('txCount').textContent = `${txList.length} total`;
  if (!txList.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ’³</div><div class="empty-title">No transactions yet</div><div class="empty-sub">Add your first income or expense to get started.</div></div>`;
    return;
  }
  list.innerHTML = recent.map(t => `
    <div class="tx-item">
      <div class="tx-icon" style="background:${catColors[t.cat]||'#444'}22;">${catEmoji[t.cat]||'ğŸ“¦'}</div>
      <div class="tx-info">
        <div class="tx-name">${esc(t.desc)}</div>
        <div class="tx-meta">${t.cat} Â· ${fmtDate(t.date)}${t.note?' Â· '+esc(t.note):''}</div>
      </div>
      <div class="tx-right">
        <div class="tx-amount ${t.type}">${t.type==='credit'?'+':'-'}${profile.symbol}${fmt(t.amount)}</div>
        <button class="tx-del" onclick="deleteTx(${t.id})" title="Delete">âœ•</button>
      </div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALL TRANSACTIONS TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAllTx() {
  const search = (document.getElementById('txSearch')?.value||'').toLowerCase();
  const fType  = document.getElementById('txFilterType')?.value||'';
  const fCat   = document.getElementById('txFilterCat')?.value||'';
  const fMonth = document.getElementById('txFilterMonth')?.value||'';
  let filtered = [...txList].sort((a,b)=>new Date(b.date)-new Date(a.date));
  if (search) filtered = filtered.filter(t=>t.desc.toLowerCase().includes(search)||t.cat.toLowerCase().includes(search)||(t.note||'').toLowerCase().includes(search));
  if (fType)  filtered = filtered.filter(t=>t.type===fType);
  if (fCat)   filtered = filtered.filter(t=>t.cat===fCat);
  if (fMonth) filtered = filtered.filter(t=>t.date.slice(0,7)===fMonth);
  document.getElementById('txViewCount').textContent = `${filtered.length} of ${txList.length} transactions`;
  const body  = document.getElementById('allTxBody');
  const empty = document.getElementById('allTxEmpty');
  if (!filtered.length) { body.innerHTML=''; empty.style.display=''; return; }
  empty.style.display='none';
  body.innerHTML = filtered.map(t=>`
    <tr>
      <td><span style="font-family:'DM Mono',monospace;font-size:.73rem;">${fmtDate(t.date)}</span></td>
      <td><div style="font-weight:500;font-size:.8rem;">${esc(t.desc)}</div>${t.note?`<div style="font-size:.68rem;color:var(--muted);">${esc(t.note)}</div>`:''}</td>
      <td><span class="badge" style="background:${catColors[t.cat]||'#444'}22;color:${catColors[t.cat]||'#888'};">${catEmoji[t.cat]||''} ${t.cat}</span></td>
      <td><span class="badge" style="background:${t.type==='credit'?'rgba(76,207,176,.12)':'rgba(224,92,122,.12)'};color:${t.type==='credit'?'var(--teal)':'var(--rose)'};">${t.type==='credit'?'Income':'Expense'}</span></td>
      <td style="text-align:right;font-family:'DM Mono',monospace;font-size:.8rem;font-weight:500;" class="${t.type}">${t.type==='credit'?'+':'-'}${profile.symbol}${fmt(t.amount)}</td>
      <td style="text-align:right;"><button class="btn btn-danger" onclick="deleteTx(${t.id});renderAllTx();">âœ•</button></td>
    </tr>`).join('');
}

function updateFilterOptions() {
  const cats   = [...new Set(txList.map(t=>t.cat))].sort();
  const months = [...new Set(txList.map(t=>t.date.slice(0,7)))].sort().reverse();
  const catSel   = document.getElementById('txFilterCat');
  const monthSel = document.getElementById('txFilterMonth');
  const cur1=catSel?.value||'', cur2=monthSel?.value||'';
  if (catSel)   catSel.innerHTML   = `<option value="">All Categories</option>`+cats.map(c=>`<option value="${c}"${c===cur1?' selected':''}>${c}</option>`).join('');
  if (monthSel) monthSel.innerHTML = `<option value="">All Months</option>`+months.map(m=>`<option value="${m}"${m===cur2?' selected':''}>${monthLabel(m)}</option>`).join('');
}
function monthLabel(ym){ const[y,m]=ym.split('-'); return new Date(y,m-1,1).toLocaleDateString('en-US',{month:'long',year:'numeric'}); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DELETE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function deleteTx(id) {
  if (!confirm('Delete this transaction?')) return;
  txList = txList.filter(t=>t.id!==id);
  save(); refreshAll(); showToast('Transaction deleted');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DONUT CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawDonut() {
  const cats = {};
  txList.filter(t=>t.type==='debit').forEach(t=>{ cats[t.cat]=(cats[t.cat]||0)+t.amount; });
  const sorted = Object.entries(cats).sort((a,b)=>b[1]-a[1]).slice(0,6);
  const total  = sorted.reduce((s,[,v])=>s+v,0);
  document.getElementById('donut-total').textContent = total ? profile.symbol+fmt(total) : 'â€”';
  const canvas = document.getElementById('donutChart');
  const ctx = canvas.getContext('2d');
  const cx=65,cy=65,r=52,inner=35;
  ctx.clearRect(0,0,130,130);
  if (!sorted.length) {
    ctx.beginPath(); ctx.arc(cx,cy,r,0,2*Math.PI); ctx.fillStyle='#1e2d3d'; ctx.fill();
    ctx.beginPath(); ctx.arc(cx,cy,inner,0,2*Math.PI); ctx.fillStyle='#141d26'; ctx.fill();
    document.getElementById('legendList').innerHTML='<div style="text-align:center;font-size:.73rem;color:var(--muted);padding:.5rem 0;">No expenses yet</div>';
    return;
  }
  let angle=-Math.PI/2;
  sorted.forEach(([cat,val])=>{
    const slice=(val/total)*2*Math.PI;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,angle,angle+slice); ctx.closePath();
    ctx.fillStyle=catColors[cat]||'#444'; ctx.fill(); angle+=slice;
  });
  ctx.beginPath(); ctx.arc(cx,cy,inner,0,2*Math.PI); ctx.fillStyle='#141d26'; ctx.fill();
  angle=-Math.PI/2;
  sorted.forEach(([,val])=>{
    const slice=(val/total)*2*Math.PI;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(cx+r*Math.cos(angle),cy+r*Math.sin(angle));
    ctx.strokeStyle='#141d26'; ctx.lineWidth=2; ctx.stroke(); angle+=slice;
  });
  document.getElementById('legendList').innerHTML=sorted.map(([cat,val])=>`
    <div class="legend-item">
      <div class="legend-left"><div class="legend-dot" style="background:${catColors[cat]||'#444'}"></div><div>${cat}</div></div>
      <div class="legend-val">${profile.symbol}${fmt(val)}</div>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LINE CHART â€” properly bounded to its container
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let chartAnimFrame;

function getMonthlyData(nMonths) {
  const now = new Date();
  const months = [];
  for (let i=nMonths-1; i>=0; i--) {
    const d = new Date(now.getFullYear(), now.getMonth()-i, 1);
    months.push({ key:`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`, label:d.toLocaleDateString('en-US',{month:'short'}) });
  }
  const income   = months.map(m=>txList.filter(t=>t.type==='credit'&&t.date.slice(0,7)===m.key).reduce((s,t)=>s+t.amount,0));
  const expenses = months.map(m=>txList.filter(t=>t.type==='debit' &&t.date.slice(0,7)===m.key).reduce((s,t)=>s+t.amount,0));
  return { labels:months.map(m=>m.label), income, expenses };
}

function drawLineChart(period) {
  const canvas = document.getElementById('spendChart');
  if (!canvas) return;

  // Use the container's dimensions, not canvas's own
  const wrap = canvas.parentElement;
  const W = wrap.clientWidth  || 400;
  const H = wrap.clientHeight || 180;
  const dpr = window.devicePixelRatio || 1;

  canvas.width  = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width  = W + 'px';
  canvas.style.height = H + 'px';

  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);

  const nMonths = period==='3m'?3:period==='6m'?6:12;
  const { labels, income, expenses } = getMonthlyData(nMonths);

  const pad = { top:14, right:14, bottom:28, left:52 };
  const cW = W - pad.left - pad.right;
  const cH = H - pad.top  - pad.bottom;
  const maxVal = Math.max(...income, ...expenses, 1) * 1.2;
  const n = labels.length;

  function xPos(i){ return pad.left + (n > 1 ? (i/(n-1))*cW : cW/2); }
  function yPos(v){ return pad.top + cH - (v/maxVal)*cH; }

  cancelAnimationFrame(chartAnimFrame);
  let startTs;

  function animate(ts) {
    if (!startTs) startTs=ts;
    const progress = Math.min((ts-startTs)/900, 1);
    ctx.clearRect(0, 0, W, H);

    // Grid lines
    [0.25, 0.5, 0.75, 1].forEach(f => {
      const y = pad.top + cH*(1-f);
      ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(W-pad.right, y);
      ctx.strokeStyle='rgba(255,255,255,.04)'; ctx.lineWidth=1; ctx.stroke();
      const val = f*maxVal;
      const label = val>=1000000 ? (val/1000000).toFixed(1)+'M' : val>=1000 ? (val/1000).toFixed(0)+'k' : val.toFixed(0);
      ctx.fillStyle='#6b7a8d'; ctx.font=`9px 'DM Mono',monospace`; ctx.textAlign='right';
      ctx.fillText(label, pad.left-6, y+3);
    });

    // X-axis labels
    labels.forEach((l,i) => {
      ctx.fillStyle='#6b7a8d'; ctx.textAlign='center'; ctx.font=`9px 'DM Mono',monospace`;
      ctx.fillText(l, xPos(i), H-pad.bottom+14);
    });

    function drawLine(data, color) {
      const visible = Math.max(1, Math.floor(n * progress));
      // Fill area
      const grad = ctx.createLinearGradient(0,pad.top,0,pad.top+cH);
      grad.addColorStop(0, color+'28'); grad.addColorStop(1, color+'00');
      ctx.beginPath();
      ctx.moveTo(xPos(0), yPos(data[0]));
      for (let i=1; i<visible; i++) ctx.lineTo(xPos(i), yPos(data[i]));
      ctx.lineTo(xPos(visible-1), pad.top+cH);
      ctx.lineTo(xPos(0), pad.top+cH);
      ctx.closePath(); ctx.fillStyle=grad; ctx.fill();
      // Line
      ctx.beginPath();
      ctx.moveTo(xPos(0), yPos(data[0]));
      for (let i=1; i<visible; i++) ctx.lineTo(xPos(i), yPos(data[i]));
      ctx.strokeStyle=color; ctx.lineWidth=2; ctx.lineJoin='round'; ctx.stroke();
      // Dots
      for (let i=0; i<visible; i++) {
        ctx.beginPath(); ctx.arc(xPos(i), yPos(data[i]), 3.5, 0, Math.PI*2);
        ctx.fillStyle=color; ctx.fill();
        ctx.beginPath(); ctx.arc(xPos(i), yPos(data[i]), 1.8, 0, Math.PI*2);
        ctx.fillStyle='#0e1318'; ctx.fill();
      }
    }

    drawLine(income,   '#4ccfb0');
    drawLine(expenses, '#e05c7a');
    if (progress < 1) chartAnimFrame = requestAnimationFrame(animate);
  }
  chartAnimFrame = requestAnimationFrame(animate);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGoalsDash() {
  const container = document.getElementById('goalsList-dash');
  if (!goals.length) {
    container.innerHTML=`<div class="empty"><div class="empty-icon">ğŸ¯</div><div class="empty-title">No goals yet</div><div class="empty-sub">Click "+ Goal" to create one.</div></div>`;
    return;
  }
  container.innerHTML=goals.map((g,i)=>{ const pct=Math.min(Math.round((g.saved/g.target)*100),100); return goalHTML(g,i,pct); }).join('');
  setTimeout(()=>{ document.querySelectorAll('.progress-fill').forEach(el=>{ el.style.width=el.dataset.w; }); },100);
}

function renderGoalsFull() {
  const container = document.getElementById('goalsList-full');
  const empty     = document.getElementById('goalsEmpty');
  if (!goals.length) { container.innerHTML=''; empty.style.display=''; return; }
  empty.style.display='none';
  container.innerHTML=goals.map((g,i)=>{ const pct=Math.min(Math.round((g.saved/g.target)*100),100); return `<div class="chart-card" style="animation-delay:${i*.05}s;">`+goalHTML(g,i,pct)+`</div>`; }).join('');
  setTimeout(()=>{ document.querySelectorAll('.progress-fill').forEach(el=>{ el.style.width=el.dataset.w; }); },100);
}

function goalHTML(g,i,pct) {
  const remaining=Math.max(g.target-g.saved,0);
  const dateStr=g.targetDate?` Â· Due ${fmtDate(g.targetDate)}`:'';
  return `
    <div class="goal-item">
      <div class="goal-header">
        <div class="goal-name">ğŸ¯ ${esc(g.name)}</div>
        <div class="goal-pct">${pct}%${dateStr}</div>
      </div>
      <div class="progress-track"><div class="progress-fill" style="width:0%;background:${g.color};" data-w="${pct}%"></div></div>
      <div class="goal-sub">
        <span>${profile.symbol}${fmt(g.saved)} saved</span>
        <span>${profile.symbol}${fmt(remaining)} to go</span>
      </div>
      <div class="goal-actions">
        <button class="goal-mini-btn" onclick="openDepositModal(${i})">+ Deposit</button>
        <button class="goal-mini-btn del" onclick="deleteGoal(${i})">Remove</button>
      </div>
    </div>`;
}

function deleteGoal(i) {
  if (!confirm('Remove this goal?')) return;
  goals.splice(i,1); save(); renderGoalsDash(); renderGoalsFull();
  showToast('Goal removed');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADD TRANSACTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addTransaction() {
  const type   = document.getElementById('txType').value;
  const amount = parseFloat(document.getElementById('txAmount').value);
  const desc   = document.getElementById('txDesc').value.trim();
  const cat    = document.getElementById('txCat').value;
  const date   = document.getElementById('txDate').value;
  const note   = document.getElementById('txNote').value.trim();
  if (!amount||amount<=0) { showToast('Enter a valid amount', true); return; }
  if (!desc)              { showToast('Add a description', true); return; }
  if (!date)              { showToast('Select a date', true); return; }
  txList.push({ id:Date.now(), type, amount, desc, cat, date, note });
  save(); closeModal(); refreshAll();
  showToast(`${type==='credit'?'Income':'Expense'} of ${profile.symbol}${fmt(amount)} added`);
  document.getElementById('txAmount').value='';
  document.getElementById('txDesc').value='';
  document.getElementById('txNote').value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADD GOAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addGoal() {
  const name   = document.getElementById('goalName').value.trim();
  const target = parseFloat(document.getElementById('goalTarget').value);
  const saved  = parseFloat(document.getElementById('goalSaved').value)||0;
  const color  = document.getElementById('goalColor').value;
  const tDate  = document.getElementById('goalDate').value;
  if (!name)            { showToast('Goal needs a name', true); return; }
  if (!target||target<=0){ showToast('Enter a valid target', true); return; }
  if (saved>target)     { showToast('Saved amount exceeds target', true); return; }
  goals.push({ name, target, saved, color, targetDate:tDate||null });
  save(); closeGoalModal(); renderGoalsDash(); renderGoalsFull();
  showToast('Goal created!');
  ['goalName','goalTarget','goalSaved','goalDate'].forEach(id=>document.getElementById(id).value='');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEPOSIT TO GOAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openDepositModal(i) {
  depositGoalIdx=i;
  document.getElementById('depositGoalName').textContent=goals[i].name;
  document.getElementById('depositAmount').value='';
  document.getElementById('depositModal').classList.add('open');
}
function closeDepositModal(){ document.getElementById('depositModal').classList.remove('open'); }
function closeDepositCheck(e){ if(e.target===document.getElementById('depositModal')) closeDepositModal(); }
function depositToGoal() {
  const amt=parseFloat(document.getElementById('depositAmount').value);
  if (!amt||amt<=0) { showToast('Enter a valid amount', true); return; }
  const g=goals[depositGoalIdx];
  g.saved=Math.min(g.saved+amt,g.target);
  save(); closeDepositModal(); renderGoalsDash(); renderGoalsFull();
  showToast(`${profile.symbol}${fmt(amt)} added to "${g.name}"`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportData() {
  const data={ profile, transactions:txList, goals, exportedAt:new Date().toISOString() };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download=`vault-export-${new Date().toISOString().slice(0,10)}.json`; a.click();
  showToast('Data exported');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function esc(s){ const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
function fmtDate(d){ return new Date(d+'T00:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}); }
function showToast(msg,err=false){
  const t=document.getElementById('toast');
  t.textContent=(err?'âš  ':'âœ¦ ')+msg;
  t.className='toast'+(err?' error':'');
  t.classList.add('show');
  clearTimeout(t._tid);
  t._tid=setTimeout(()=>t.classList.remove('show'),3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(){ document.getElementById('modalOverlay').classList.add('open'); }
function closeModal(){ document.getElementById('modalOverlay').classList.remove('open'); }
function closeModalCheck(e){ if(e.target===document.getElementById('modalOverlay')) closeModal(); }
function openGoalModal(){ document.getElementById('goalModalOverlay').classList.add('open'); }
function closeGoalModal(){ document.getElementById('goalModalOverlay').classList.remove('open'); }
function closeGoalCheck(e){ if(e.target===document.getElementById('goalModalOverlay')) closeGoalModal(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showView(name, el) {
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById('view-'+name).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  if (el) el.classList.add('active');
  closeSidebar();
  if (name==='transactions') renderAllTx();
  if (name==='goals') renderGoalsFull();
  if (name==='dashboard') { requestAnimationFrame(()=>{ drawLineChart(currentPeriod); drawDonut(); }); }
}

function setPeriod(el, p) {
  document.querySelectorAll('.period-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  currentPeriod=p;
  drawLineChart(p);
}

// Redraw chart on resize after layout settles
let resizeTimer;
window.addEventListener('resize', ()=>{
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(()=>drawLineChart(currentPeriod), 150);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if (profile) { startApp(); }
</script>
</body>
</html>